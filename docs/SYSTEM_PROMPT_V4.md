# 系统提示 v4.0 - 专业规范版

## 版本信息
- **版本**: v4.0
- **更新日期**: 2026-02-01
- **字符数**: 1807
- **行数**: 116

## 核心改进

### 1. 强化不确定性原则
**新增内容**：
- 明确要求"仅凭文字描述无法做出明确判断时，必须明确说明'无法仅凭描述判断'"
- 规范了概率性、条件性表达方式
- 明确禁止使用确定性表述（就是、确诊为、肯定是、一定是）

**意义**：防止AI过度自信，避免误导用户

### 2. 避免误诊与标签化
**新增章节**：
```
【2. 避免误诊与标签化】
- 不要将用户的症状直接总结或改写为疾病名称
- 不要使用"症状包括：某某疾病"的表达方式
- 不要通过列举疾病清单的方式代替分析
- 可以讨论"可能的方向、机制或常见原因"，但需强调需要医生评估确认
```

**意义**：
- 防止AI给用户"贴标签"
- 避免将症状描述转换为疾病诊断
- 强调分析过程而非结论

### 3. 信息不足时的处理方式
**新增处理流程**：
```
当信息不足以支持判断时，应按以下顺序回答：
1) 明确说明无法仅凭当前信息判断
2) 提出需要补充的关键信息（如持续时间、严重程度、伴随症状、既往史）
3) 给出合理的就医或观察建议
```

**意义**：规范了AI面对信息不足时的标准回答流程

### 4. 强调"有用但克制"
**新增原则**：
```
【4. 回答应以"有用但克制"为目标】
- 提供下一步行动建议（就医、检查、观察要点）
- 不夸大风险，也不淡化潜在危险
- 避免冗长模板化输出
```

**意义**：
- 防止AI回答过于冗长、模板化
- 平衡信息完整性和实用性
- 避免"为了回答而回答"

### 5. 优化安全分诊表述
**改进**：
- 增加了"仅在与用户描述相关时，提及对应就医建议，不要机械复述清单"
- 明确区分"立即急诊"、"尽快就医"、"可短期观察"

**意义**：防止AI机械地复述整个急诊清单

### 6. 增加"克制性"质量要求
**新增**：
```
5. 克制性：不下结论、不夸大、不模板化
```

**意义**：明确要求AI保持专业克制

## 与v3.0的对比

| 维度 | v3.0 | v4.0 |
|------|------|------|
| 字符数 | 1567 | 1807 |
| 行数 | 116 | 116 |
| 不确定性 | 提及 | **强化并详细规范** |
| 标签化问题 | 未提及 | **新增专门章节** |
| 信息不足 | 未明确 | **新增处理流程** |
| 克制性 | 未强调 | **新增为核心原则** |
| 模板化 | 未提及 | **明确要求避免** |
| 表达风格 | 说明性 | **更专业、更规范** |

## 解决的问题

### 问题1：AI过度自信
**v3.0问题**：AI可能给出过于确定的判断
**v4.0解决**：强制要求使用不确定性表述，禁止确定性判断

### 问题2：症状→疾病的直接转换
**v3.0问题**：AI可能说"您的症状包括：痔疮、肛裂"
**v4.0解决**：明确禁止将症状总结为疾病名称，要求讨论"可能的方向"而非"疾病列表"

### 问题3：信息不足时乱猜
**v3.0问题**：信息不足时AI仍尝试给出判断
**v4.0解决**：规范了标准流程：说明信息不足 → 询问关键信息 → 给建议

### 问题4：冗长模板化回答
**v3.0问题**：AI可能输出冗长的模板化内容
**v4.0解决**：明确要求"有用但克制"，避免模板化

### 问题5：机械复述急诊清单
**v3.0问题**：每次都复述整个急诊情况清单
**v4.0解决**："仅在与用户描述相关时提及"

## 应用场景改进

### 场景1：模糊症状描述
**用户**："腿酸痛，膝盖以下凉"

**v3.0回答风格**：
- 可能列举多种疾病
- 给出大量检查建议
- 机械复述所有可能

**v4.0回答风格**：
- 说明需要更多信息（持续时间、程度、伴随症状）
- 讨论可能的影响因素（循环、神经、疲劳等）
- 给出针对性的就医建议
- 保持克制，不过度推测

### 场景2：痔疮相关问题
**用户**："痔疮出血怎么办"

**v3.0问题**：
- 可能直接说"您的症状包括：内痔、外痔"
- 列举各种痔疮类型

**v4.0改进**：
- 不将"痔疮出血"总结为疾病名称
- 讨论"出血的常见情况和需要关注的要点"
- 建议就医评估具体情况

## 实施状态

✅ 已更新所有位置：
1. config/system_prompt.yaml
2. config/dpo_training_config.yaml
3. config/dpo_construction_config.yaml
4. config/evaluation_config.yaml
5. config/dpo_evaluation_config.yaml
6. src/training/trainer/run_sft.py
7. src/training/scripts/run_evaluation.py (包含后处理)

## 使用建议

### 对于新训练
1. 使用v4.0系统提示进行SFT训练
2. 模型将学会更专业、更克制的回答风格
3. 避免过度自信和标签化问题

### 对于现有模型
1. 评估时会使用新提示（但模型行为可能不变）
2. 建议重新训练以充分应用新原则
3. 后处理函数仍然保留（清理格式问题）

## 版本演进

```
v1.0 (基础版) - 约200字符
  └─> 简单的5条原则

v2.0 (详细版) - 约3000字符  
  └─> 增加详细示例和7个领域
  └─> ❌ 使用✓✗符号导致格式问题

v3.0 (规范版) - 约1567字符
  └─> 移除所有格式符号
  └─> 六大模块，纯文本
  └─> ✅ 解决格式问题

v4.0 (专业规范版) - 约1807字符 ⭐
  └─> 强化不确定性原则
  └─> 避免误诊与标签化
  └─> 信息不足处理流程
  └─> 强调有用但克制
  └─> ✅ 当前版本（推荐）
```

## 验证方法

```bash
cd /root/autodl-tmp/MedQA

# 验证版本
python3 << 'EOF'
import yaml
with open('config/system_prompt.yaml', 'r') as f:
    prompt = yaml.safe_load(f)['system_prompt']
    
is_v4 = ('避免误诊与标签化' in prompt and 
         '有用但克制' in prompt and
         '信息不足时的处理方式' in prompt)

print(f"版本: {'✅ v4.0' if is_v4 else '❌ 旧版本'}")
print(f"长度: {len(prompt)} 字符")
EOF
```

## 预期效果

使用v4.0训练的模型应该：
1. ✅ 更谨慎，不过度自信
2. ✅ 不给用户"贴疾病标签"
3. ✅ 信息不足时会明确说明并询问
4. ✅ 回答简洁实用，不冗长模板化
5. ✅ 不机械复述清单
6. ✅ 保持专业克制的风格

---

**更新日期**: 2026-02-01  
**状态**: ✅ 已全部部署  
**建议**: 使用v4.0重新训练SFT和DPO模型
