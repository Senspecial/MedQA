# 医疗AI系统提示词完善说明

## 📋 更新概览

本次更新对医疗AI系统提示词进行了全面的完善和优化，使其更加实用、具体和平衡。

## 🎯 主要改进点

### 1️⃣ 调整严格程度 - 更加平衡和实用

#### 之前的问题
- 过于简单的禁止性描述，缺乏具体指导
- 没有明确"什么程度的建议是可以的"
- 容易导致模型过度保守，拒绝提供有用信息

#### 改进内容
✅ **明确了可接受的边界**：
- 可以提供药物类别建议（如"退烧药"、"抗生素"），但不含剂量
- 可以说明药物注意事项（如"饭后服用"、"不能突然停药"）
- 可以给出一般性治疗原则（如"需要饮食控制"、"需要规律用药"）

✅ **分级就医建议**：
- 🚨 **立即急诊**：9类危急情况（胸痛、意识改变、大出血等）
- ⚠️ **24小时内就医**：7类需要尽快处理的情况
- 📋 **可观察1-2天**：4类轻微症状
- 明确了哪些情况可以"先观察"，避免过度就医

✅ **实用性增强**：
- 可以评估症状紧急程度
- 可以提供观察要点
- 可以给出生活方式建议的具体数据（如"每天盐摄入不超过6克"）

### 2️⃣ 添加领域知识 - 覆盖主要医疗科室

#### 新增内容：核心职责与领域覆盖

**覆盖的医疗领域**：
1. **内科领域**：感冒、发烧、咳嗽、胃肠疾病、高血压、糖尿病、心脑血管疾病
2. **外科领域**：外伤处理、骨折、烧烫伤、伤口护理
3. **妇产科**：月经不调、孕期保健、产后护理、妇科常见病
4. **儿科**：儿童发育、疫苗接种、常见儿童疾病
5. **皮肤科**：皮疹、过敏、痤疮、皮肤感染
6. **五官科**：视力问题、听力问题、鼻炎、咽炎
7. **心理健康**：焦虑、抑郁、睡眠障碍的初步识别

**明确的服务范围**：
- 症状分析与就医指导
- 用药咨询与安全
- 健康管理与预防
- 医疗流程与就诊建议

### 3️⃣ 补充禁忌项 - 增加反例说明

#### 之前：简单列举
```
❌ 不可以做的：
- 明确诊断
- 开具处方
- 停药换药指导
- 替代医生做决策
```

#### 现在：详细反例 + 原因说明

**6大类禁止行为，每类4个具体反例**：

1. **明确诊断** (4个反例)
   - ✗ "你得的是急性胃炎" → 只有医生面诊后才能确诊
   - ✗ "这就是糖尿病的症状" → 需要检查结果才能诊断
   - ✗ "肯定是细菌感染" → 需要实验室检查确认
   - ✗ "确诊为高血压" → 需要多次测量和医生评估

2. **开具处方** (4个反例)
   - ✗ "服用阿莫西林500mg，每天3次" → 这是处方行为
   - ✗ "早晚各一片降压药" → 具体用药需医生制定
   - ✗ "连续服用7天头孢" → 疗程需医生决定
   - ✗ "每次2片，饭后服用" → 具体剂量不能给出

3. **停药换药** (4个反例)
4. **阻止就医** (4个反例)
5. **推荐偏方** (3个反例)
6. **危险建议** (3个反例)

**总计：22个具体反例，每个都说明了为什么不能这样做**

### 4️⃣ 增加示例 - 大幅增加正面范例

#### 统计对比

| 类别 | 之前 | 现在 | 增加 |
|------|------|------|------|
| **推荐做法示例** | 6个 | 25个 | +319% |
| **禁止做法反例** | 4个 | 22个 | +450% |
| **急症情况列举** | 简单描述 | 9类详细分类 | 质的提升 |
| **就医时机指导** | 无 | 3级分类体系 | 全新 |

#### 推荐做法的7大类示例（共25个）

1. **不确定性表述** (4个示例)
   - ✓ "根据您的症状，可能是感冒或流感引起的"
   - ✓ "这种情况常见于消化不良，也可能是胃炎的表现"
   - 等

2. **检查和就医建议** (4个示例)
3. **一般性用药建议** (4个示例)
4. **药物注意事项** (3个示例)
5. **疾病解释** (3个示例)
6. **生活方式建议** (4个示例)
7. **就医时机评估** (3个示例)

## 📊 结构对比

### 之前的系统提示（约15行）
```
核心职责：5条简单列举
回答原则：
  ✅ 可以做的：6个要点
  ❌ 不可以做的：4个要点
安全原则：4条简单描述
回答质量要求：4个维度
```

### 现在的系统提示（约200行）
```
核心职责与领域覆盖：
  1. 常见疾病科普（7个科室）
  2-5. 其他4大职责详细说明

回答原则与示例：
  ✅ 推荐做法：7大类，25个具体示例
  ❌ 禁止做法：6大类，22个反例 + 原因

安全红线：
  🚨 立即急诊：9类情况详细列举
  ⚠️ 24小时内就医：7类情况
  📋 可观察1-2天：4类情况
  🔒 不确定时的处理：4条原则

回答质量标准：5个维度详细说明
```

## ✨ 核心改进特点

### 1. 从"禁止清单"到"行为指南"
- **之前**：主要告诉模型"不能做什么"
- **现在**：详细说明"应该怎么做"，提供大量正面示例

### 2. 从"简单规则"到"分级体系"
- **之前**：一刀切的"建议就医"
- **现在**：立即急诊 / 24小时内 / 可观察，分级指导

### 3. 从"抽象原则"到"具体示例"
- **之前**："使用不确定表述"
- **现在**：4个具体的句式示例 + 正确用法

### 4. 从"单一维度"到"多科室覆盖"
- **之前**：泛泛的"医疗助手"
- **现在**：明确覆盖7个主要科室的常见疾病

## 🎯 预期效果

使用新的系统提示后，模型应该能够：

### ✅ 更好的表现

1. **更实用的建议**
   - 可以给出"药物类别"建议（不含剂量）
   - 可以说明"用药注意事项"
   - 可以提供"生活方式"的具体数据

2. **更合理的边界**
   - 轻症可以"观察1-2天"，不是一律建议就医
   - 可以评估症状严重程度
   - 明确区分"急诊"、"尽快就医"、"可观察"

3. **更丰富的知识覆盖**
   - 7个主要科室的常见疾病
   - 从内科到外科，从儿科到心理健康

4. **更清晰的行为模式**
   - 25个推荐做法示例
   - 22个禁止做法反例
   - 模型有更明确的参考

### ⚖️ 保持的安全性

1. **核心安全红线不变**
   - 不诊断、不开处方、不停药换药
   - 危急症状必须建议急诊
   - 不确定时引导就医

2. **更细致的安全分级**
   - 9类立即急诊情况
   - 明确的危险信号识别

## 📝 使用说明

### 所有配置文件已更新

✅ `src/training/trainer/run_sft.py` - SFT训练
✅ `config/dpo_training_config.yaml` - DPO训练  
✅ `config/evaluation_config.yaml` - SFT评估
✅ `config/dpo_evaluation_config.yaml` - DPO评估

### 主模板文件

📄 `config/system_prompt_full.yaml` - 完整系统提示主模板

如需修改，建议：
1. 修改 `system_prompt_full.yaml` 主模板
2. 使用提供的Python脚本同步到所有配置文件

### 快速同步脚本

```python
import yaml

# 读取主模板
with open('config/system_prompt_full.yaml', 'r', encoding='utf-8') as f:
    full_prompt = yaml.safe_load(f)['system_prompt']

# 更新所有配置文件
configs = [
    'config/dpo_training_config.yaml',
    'config/evaluation_config.yaml',
    'config/dpo_evaluation_config.yaml'
]

for config_file in configs:
    with open(config_file, 'r', encoding='utf-8') as f:
        config = yaml.safe_load(f)
    config['system_prompt'] = full_prompt
    with open(config_file, 'w', encoding='utf-8') as f:
        yaml.dump(config, f, allow_unicode=True, default_flow_style=False, sort_keys=False)
```

## 🔄 后续优化建议

### 1. 根据评估结果调整
- 观察模型在新系统提示下的表现
- 根据"越权率"和"幻觉率"微调边界
- 收集实际使用中的问题案例

### 2. 领域扩展
- 可根据实际需求增加专科知识（如肿瘤科、中医科等）
- 增加特定人群的指导（老年人、孕妇等）

### 3. 示例更新
- 定期补充新的正面/反面示例
- 根据模型实际输出调整示例方向

### 4. 本地化调整
- 根据地区医疗体系调整就医建议
- 考虑不同地区的医疗资源可及性

## 📈 评估建议

使用新系统提示后，建议关注以下指标：

1. **安全性指标**
   - 越权率是否保持在安全范围（<25%）
   - 幻觉率是否降低（<20%）
   - 危险建议数量（应为0）

2. **实用性指标**
   - 通过率（预期提升至50-60%）
   - 用户满意度
   - 信息完整性

3. **平衡性指标**
   - 是否过于保守（一律建议就医）
   - 是否提供了实际有用的信息
   - 不确定表述的使用频率

---

**更新日期**：2024
**版本**：v2.0 - 完善版
**维护**：建议每季度review一次，根据实际效果调整
