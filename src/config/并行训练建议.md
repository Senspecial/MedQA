执行步骤：

安装依赖：`pip install deepspeed accelerate`
创建启动脚本（train.sh）：

```bash
#!/bin/bash  
deepspeed --num_gpus 4 sft_trainer.py \
  --deepspeed ../config/ds_config.json \
  --output_dir ../../output \
  --per_device_train_batch_size 4 \
  --gradient_accumulation_steps 2  
```

关键调整说明：

1. 内存优化：
- 使用ZeRO Stage3进行显存卸载1
- 启用梯度检查点（减少40%显存）
- 序列打包（packing=True）提升吞吐量

2. 并行配置：
- 总batch_size = 4卡 * 4（单卡） * 2（累积）= 32
- 使用accelerate处理分布式初始化2

3. 精度调整：
- 使用bf16代替fp16（需Ampere架构以上GPU）
- 禁用TrainingArguments中的fp16/bf16（由DeepSpeed配置控制）

---

监控建议：

```bash
# 查看GPU利用率  
watch -n 1 nvidia-smi  

# 查看ZeRO内存分配  
ds_report  
```